{
	"next_topic_id": 2,
	"topic": [
		{
			"topic_id": 1,
			"title": "用linux udp tunnel+squid来翻墙",
			"body": "墙内机器(X.X.X.X)\n墙外机器(Y.Y.Y.Y)\n\n两台均设置squid(形成父子squid)\n环境ubuntu16.04\napt install squid\n\n墙内机器上配置:\nmodprobe fou\nip fou add port 7373 ipproto 4\nip link add udptun1 type ipip local X.X.X.X remote Y.Y.Y.Y encap fou encap-sport auto encap-dport 8484\nip addr add 10.53.1.1 peer 10.53.1.2 dev udptun1\nip link set udptun1 up\n\nudp加密配置:\nip tunnel add ipsec1 mode ipip local 10.53.1.1 remote 10.53.1.2 dev udptun1\nip addr add 10.53.2.1 peer 10.53.2.2 dev ipsec1\nip link set ipsec1 up\nip xfrm state add src 10.53.1.1 dst 10.53.1.2 proto esp spi 201 enc blowfish 0xc0de0201\nip xfrm state add src 10.53.1.2 dst 10.53.1.1 proto esp spi 102 enc blowfish 0xc0de0102\nip xfrm policy add dev udptun1 dir out tmpl proto esp spi 201\nip xfrm policy add dev udptun1 dir in tmpl proto esp spi 102\n\n\n墙外机器机器上配置:\nmodprobe fou\nip fou add port 8484 ipproto 4\nip link add udptun1 type ipip local Y.Y.Y.Y  remote  X.X.X.X encap fou encap-sport auto encap-dport 7373\nip addr add 10.53.1.2 peer 10.53.1.1 dev udptun1\nip link set udptun1 up\n\nudp加密配置:\nip tunnel add ipsec1 mode ipip local 10.53.1.2 remote 10.53.1.1 dev udptun1\nip addr add 10.53.2.2 peer 10.53.2.1 dev ipsec1\nip link set ipsec1 up\nip xfrm state add src 10.53.1.2 dst 10.53.1.1 proto esp spi 102 enc blowfish 0xc0de0102\nip xfrm state add src 10.53.1.1 dst 10.53.1.2 proto esp spi 201 enc blowfish 0xc0de0201\nip xfrm policy add dev udptun1 dir out tmpl proto esp spi 102\nip xfrm policy add dev udptun1 dir in tmpl proto esp spi 201\n\n\n墙内机器设置squid\n#cat /etc/squid/squid.conf\nacl localnet src 10.0.0.0/8       # 只允许指定的内部局域网访问squid\nacl cknet src 111.111.111.111/32     # 只允许指定的ip访问squid\nacl SSL_ports port 443\nacl Safe_ports port 80          # http\nacl Safe_ports port 21          # ftp\nacl Safe_ports port 443         # https\nacl Safe_ports port 70          # gopher\nacl Safe_ports port 210         # wais\nacl Safe_ports port 1025-65535  # unregistered ports\nacl Safe_ports port 280         # http-mgmt\nacl Safe_ports port 488         # gss-http\nacl Safe_ports port 591         # filemaker\nacl Safe_ports port 777         # multiling http\nacl CONNECT method CONNECT\nhttp_access allow localnet\nhttp_access allow cknet\nhttp_access allow localhost\nnever_direct allow all\nhttp_access deny all\nhttp_port 65000\ncache_peer 10.53.2.2 parent 65000 0 proxy-only\ncache_dir ufs /var/spool/squid 100 16 256\naccess_log daemon:/var/log/squid/access.log squid\ncoredump_dir /var/spool/squid\nrefresh_pattern ^ftp:           1440    20%     10080\nrefresh_pattern ^gopher:        1440    0%      1440\nrefresh_pattern -i (/cgi-bin/|\\?) 0     0%      0\nrefresh_pattern .               0       20%     4320\n\n墙外机squid设置\n#cat /etc/squid/squid.conf\nacl localnet src 10.0.0.0/8     # RFC1918 possible internal network\nacl SSL_ports port 443\nacl Safe_ports port 80          # http\nacl Safe_ports port 21          # ftp\nacl Safe_ports port 443         # https\nacl Safe_ports port 70          # gopher\nacl Safe_ports port 210         # wais\nacl Safe_ports port 1025-65535  # unregistered ports\nacl Safe_ports port 280         # http-mgmt\nacl Safe_ports port 488         # gss-http\nacl Safe_ports port 591         # filemaker\nacl Safe_ports port 777         # multiling http\nacl CONNECT method CONNECT\nhttp_access allow localnet\nhttp_access allow localhost\nhttp_access deny all\nhttp_port 65000\ncache_dir ufs /var/spool/squid 100 16 256\naccess_log daemon:/var/log/squid3/access.log squid\ncoredump_dir /var/spool/squid3\nrefresh_pattern ^ftp:           1440    20%     10080\nrefresh_pattern ^gopher:        1440    0%      1440\nrefresh_pattern -i (/cgi-bin/|\\?) 0     0%      0\nrefresh_pattern .               0       20%     4320\n\n墙内机器设置squid\nchown -R proxy.proxy /var/spool/squid\n\n\n墙外机器设置squid\nchown -R proxy.proxy /var/spool/squid\n\n启动墙外墙内的squid\nservice squid start\nsysctl -w net.ipv4.ip_forward=1\n\n\n在墙内将你的浏览器代理设置一下(假设你的浏览器出公网的ip为111.111.111.111)\n代理服务器的ip为你的墙内机器的ip\n端口为squid所设置的65000",
			"added": 1493373544,
			"parent_topic_uri": "10_1NV87VmSkezRyz8NbFpdkYJsJUSfXx7LJa"
		}
	],
	"topic_vote": {
		"1_1D6bK8srThdj2KpBKqkWSGy37S7Zg1kZ98": 1
	},
	"next_comment_id": 1,
	"comment": {},
	"comment_vote": {}
}