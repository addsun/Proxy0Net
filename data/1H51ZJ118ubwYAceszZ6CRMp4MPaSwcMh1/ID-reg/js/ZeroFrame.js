(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n=[].slice;e=function(){function e(e){this.onCloseWebsocket=t(this.onCloseWebsocket,this),this.onOpenWebsocket=t(this.onOpenWebsocket,this),this.route=t(this.route,this),this.onMessage=t(this.onMessage,this),this.url=e,this.waiting_cb={},this.wrapper_nonce=document.location.href.replace(/.*wrapper_nonce=([A-Za-z0-9]+).*/,"$1"),this.connect(),this.next_message_id=1,this.init()}return e.prototype.init=function(){return this},e.prototype.connect=function(){return this.target=window.parent,window.addEventListener("message",this.onMessage,!1),this.cmd("innerReady")},e.prototype.onMessage=function(e){var t,n;return n=e.data,t=n.cmd,"response"===t?null!=this.waiting_cb[n.to]?this.waiting_cb[n.to](n.result):this.log("Websocket callback not found:",n):"wrapperReady"===t?this.cmd("innerReady"):"ping"===t?this.response(n.id,"pong"):"wrapperOpenedWebsocket"===t?this.onOpenWebsocket():"wrapperClosedWebsocket"===t?this.onCloseWebsocket():this.route(t,n)},e.prototype.route=function(e,t){return this.log("Unknown command",t)},e.prototype.response=function(e,t){return this.send({cmd:"response",to:e,result:t})},e.prototype.cmd=function(e,t,n){return null==t&&(t={}),null==n&&(n=null),this.send({cmd:e,params:t},n)},e.prototype.send=function(e,t){return null==t&&(t=null),e.wrapper_nonce=this.wrapper_nonce,e.id=this.next_message_id,this.next_message_id+=1,this.target.postMessage(e,"*"),t?this.waiting_cb[e.id]=t:void 0},e.prototype.log=function(){var e;return e=1<=arguments.length?n.call(arguments,0):[],console.log.apply(console,["[ZeroFrame]"].concat(n.call(e)))},e.prototype.onOpenWebsocket=function(){return this.log("Websocket open")},e.prototype.onCloseWebsocket=function(){return this.log("Websocket close")},e}(),window.ZeroFrame=e}).call(this);